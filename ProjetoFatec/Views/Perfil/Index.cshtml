@using ProjetoFatec.Domain.Entities;
@model Perfil;
@{
    PostViewModel post = new();
}

<a>@Model.Nome</a> <br />

<a>@Model.Sobrenome</a>
<br />
 
<a>@Model.NomeCurso</a>
<br />

<a>@Model.Biografia</a>
<br />

<a>@Model.DataNascimento</a>
<br />

@if(Model.Amigos.Count != 0){
    @foreach(var am in Model.PerfisDeAmigos)
    {
        <a>amigo: @am.Nome</a>
        <br />
    }
}


@if(ViewBag.MeuPerfil){
    <a>Seção de publicar postagem</a>
}
else{
    if(!Model.Amigos.Where(a=>(a.IdPerfilSolicitado == @ViewBag.IdPerfil || a.IdPerfilSolicitante == @ViewBag.IdPerfil)).Any()){
        <form asp-action="PedidoAmizade" asp-controller="Perfil" method="post">
            @Html.HiddenFor(c=>c.Id)
            <button class="btn btn-default">Conectar</button>
        </form>
    }
    else
    {
        if (Model.Amigos.Where(a=>(a.IdPerfilSolicitado == ViewBag.IdPerfil || a.IdPerfilSolicitante == ViewBag.IdPerfil) && a.Status == ProjetoFatec.Domain.Enums.StatusAmizadeEnum.Pendente).Any())
        {
            <button disabled class="btn btn-default">Pendente</button>
        }
        else
        {
        <button disabled class="btn btn-default">Conectado</button>
        }
    }
}

@section styles{
    <link rel="stylesheet" href="~/css/perfil.css" asp-append-version="true" />
}
@{
    int quantidadeAmigos = Model.Amigos.Where(a => a.Status == ProjetoFatec.Domain.Enums.StatusAmizadeEnum.Ativo).Count();
}
<!-- aqui começa o código -->
<div class="container divPerfilMaior">
              <div class="row-4 divPostagem perfilMaior" href="#">
                <div class="col-2 divPicPostagem perfil">
                        <img class="img-fluid profile-pic pic-post col pic-postagem perfil" id="dropdownBotao" src="~/imgs/perfil.png">
                </div>
                <div class="col divPostagemInfo perfil">
                    <a class="post-nome perfil row">@Model.Nome @Model.Sobrenome</a>
                    <a class="post-amigos perfil row">@quantidadeAmigos amigos</a>
                    <a class="post-bio perfil row">Estudante do sexto semestre, apaixonado por astronomia e jogos.  </a>
                    <div class="divBtnConectar">
                        @if(!ViewBag.MeuPerfil)
                        {
                            if(!Model.Amigos.Where(a=>a.IdPerfilSolicitado == ViewBag.IdPerfil || a.IdPerfilSolicitante == ViewBag.IdPerfil).Any()){
                                <form asp-action="PedidoAmizade" asp-controller="Perfil" method="post">
                                    @Html.HiddenFor(c=>c.Id)
                                    <button class="btn row btnConectar">Conectar</button>
                                </form>
                            }
                            else
                            {
                                if (Model.Amigos.Where(a=>(a.IdPerfilSolicitado == ViewBag.IdPerfil || a.IdPerfilSolicitante == ViewBag.IdPerfil) && a.Status == ProjetoFatec.Domain.Enums.StatusAmizadeEnum.Pendente).Any())
                                {
                                    <button disabled class="btn row btnPendente">Pendente</button>
                                }
                                else
                                {
                                <button disabled class="btn row btnConectado">Conectado</button>
                                }
                            }
                        }


                      
                    </div>
                    
                    </div>
                    </div>
                    
        
                
        
            </div>
        
            <div class="row-4 container divPerfil">
              <div class="container perfilInfosPrincipal">
                <div class="container-fluid CursoSemestre">
                  <div class="container-fluid col-4 divCurso perfilInfos"  style="background-color:white;">
                    <a class="curso">Curso</a>
                    <p class="nomeCurso">@Model.NomeCurso</p>
                  </div>
                  <div class="container-fluid row divSemestre perfilInfos"  style="background-color:white;">
                    <a class="semestre">Semestre</a>
                    <p class="nomeSemestre">@Model.SemestreAtual</p>
                  </div>  
                </div>
                <div class="container-fluid divSobrePrincipal">
                  <div class="container-fluid col-6 divSobre perfilInfos"  style="background-color:white;">
                    <a class="sobre">Sobre</a>
                    <p class="nomeSobre">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec in urna lacinia ipsum malesuada vulputate ut at orci. Nunc blandit euismod lectus, eget varius urna interdum sit amet. Donec dapibus cursus ullamcorper. Nam volutpat at lacus ac consectetur. Nunc non pulvinar orci. Proin sapien elit, mattis dapibus metus in, sodales sagittis quam.</p>
                  </div> 
                </div>
                <div class="container-fluid divAmigosPrincipal">
                  <div class="container-fluid col divAmigos perfilInfos"  style="background-color:white;">
                    <a class="amigos">Amigos</a>
                    <a class="quantidade-amigos row">@quantidadeAmigos amigos</a>
                    <div class="divAmigoExibicao">
                    @foreach(var amigo in Model.PerfisDeAmigos)
                    {                    
                        <div class="container-fluid col AmigoExibicao perfilInfos"  style="background-color:white;">
                            <div class="col-2 divImagemAmigo perfilInfo">
                                <a href="@Url.Action("Index","Perfil", new{@id = amigo.Id})">
                                    <img class="img-fluid imagem-amigos perfilInfo" id="dropdownBotao" src="~/imgs/kevin.jpg">
                                    <p class="nomeAmigo">@amigo.Nome @amigo.Sobrenome</p>
                                </a>
                            </div>
                        </div>
                        
                    }

                    </div>
                  </div> 
                </div>  
              </div>

              
              <div class="row-4 container divPostagens">
                  @if(ViewBag.MeuPerfil)
                  {
                    <div class="container divHomePrincipal">
                      <div class="container-fluid divPost justify-content-between">
                          <div class="col divPic">
                        <img class="img-fluid profile-pic pic-post" id="dropdownBotao" src="~/imgs/kevin.jpg">
                          </div>
                          <a class="row divPostar" href="#" data-bs-toggle="modal" data-bs-target="#modalPostagem">
                              Criar publicação
                          </a>
                      </div>
                      </div>

                    <div class="container-fluid modal fade modal-publicar" id="modalPostagem" tabindex="-1" aria-labelledby="modalPostagem" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Criar publicação</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">

                                    <form asp-action="PublicarPostagem" asp-controller="Publicacao" method="post" enctype="multipart/form-data">
                                        <div class="modal-body">

                                            <div class="mb-3">
                                        <textarea class="form-control txtPublicacao input inputTxtPublicacao" rows="3" id="message-text" name="textoPublicacao" placeholder="No que você está pensando?" asp-for=@post.postagem></textarea><span asp-validation-for="@post.postagem"></span>
                                            </div>
                                            <a class="fa-solid fa-image fa-2xl img-upload" id="btnShowUpload" style="color: #9b3737; width: 100px;" href="#"></a>
                                            <fieldset class="upload_dropZone text-center mb-3 p-4" id='upload_dropzone'>

                                                <legend class="visually-hidden">Image uploader</legend>

                                                <svg class="upload_svg" width="60" height="60" aria-hidden="true">
                                                    <use href="#icon-imageUpload"></use>
                                                </svg>

                                                <p class="small my-2">Arraste &amp; solte imagens dentro deste quadro<br><i>ou</i></p>
                                                <input id="formFile" class="form-control input position-absolute invisible" type="file" name="imagem" accept="image/jpeg, image/png, image/svg+xml" />
                                                <label class="btn btn-upload mb-3" for="formFile" asp-for="@post.imagem">Escolha o arquivo de imagem</label>

                                                <div class="upload_gallery d-flex flex-wrap justify-content-center gap-3 mb-0"></div>

                                            </fieldset>


                                        </div>
                                        <div class="modal-footer">
                                            <button type="submit" class="btn btn-primary btnPublicar">Publicar</button>
                                        </div>
                                    </form>


                                </div>
                            </div>
                        </div>
                    </div>
                  }
                  <div class="textoPublicacoes">
                    <p class="publicacoes">Publicações</p>
                  </div>
        @if (Model.Publicacoes != null || Model.Publicacoes.Count != 0)
        {
            @foreach (var pub in Model.Publicacoes.OrderByDescending(p=>p.DataCriacao))
            {
                <div class="container divHomePrincipalPostagens">
                    <div class="container-fluid divPoste" style="background-color:white;">
                        <div class="row-4 divPostagem" href="#">
                            <div class="col-1 divPicPostagem">
                                <img class="img-fluid profile-pic pic-post col pic-postagem" id="dropdownBotao" src="../imgs/perfil.png">
                            </div>
                            <div class="row divPostagemInfo">
                                <a class="post-nome row" href="@Url.Action("Index","Perfil", new{@id = pub.Perfil.Id})">@pub.Perfil.Nome @pub.Perfil.Sobrenome</a>
                                <a class="post-curso row">@pub.Perfil.NomeCurso, @pub.Perfil.SemestreAtual</a>
                                @{
                                    var hora = DateTime.Now - pub.DataCriacao;
                                    if (hora.Days < 1)
                                    {
                                        if (hora.Hours >= 1)
                                        {
                                            if (hora.Hours == 1)
                                            {
                                                <a class="post-tempo row">@((DateTime.Now - pub.DataCriacao).Hours) hora atrás </a>
                                            }
                                            else
                                            {
                                                <a class="post-tempo row">@((DateTime.Now - pub.DataCriacao).Hours) horas atrás </a>
                                            }
                                        }
                                        else
                                        {
                                            if (hora.Minutes == 1)
                                            {
                                                <a class="post-tempo row">
                                                    @(
                                                    (DateTime.Now - pub.DataCriacao).Minutes
                                                        ) minuto atrás
                                                </a>
                                            }
                                            else
                                            {
                                                if (hora.Minutes < 1)
                                                {
                                                    <a class="post-tempo row">
                                                        @(
                                                        (DateTime.Now - pub.DataCriacao).Seconds
                                                            ) segundos atrás
                                                    </a>
                                                }
                                                else
                                                {
                                                    <a class="post-tempo row">
                                                        @(
                                                        (DateTime.Now - pub.DataCriacao).Minutes
                                                            ) minutos atrás
                                                    </a>
                                                }
                                            }
                                        }
                                    }
                                    else
                                    {
                                        if ((DateTime.Now - pub.DataCriacao).Days == 1)
                                        {
                                            <a class="post-tempo row">@((DateTime.Now - pub.DataCriacao).Days) dia atrás </a>
                                        }
                                        else
                                        {
                                            <a class="post-tempo row">@((DateTime.Now - pub.DataCriacao).Days) dias atrás </a>
                                        }
                                    }
                                }

                            </div>
                        </div>
                        <div class="row-col-4 divPostagemInfos">
                            <p class="post-conteudo row">@pub.Legenda</p>
                            @if (pub.CaminhoFoto != null)
                            {
                                <img src="../@pub.CaminhoFoto.Remove(0,8)" class="img img-fluid mx-auto d-block img-post" />
                            }<br />
                            <a class="post-qtdLike col"><span class=" fa-regular fa-heart"></span> 0 Likes</a>

                            <hr />
                            <div class="botoesPost row">
                                <a class="btn post-btnLike col">
                                    <span class=" fa-regular fa-heart"></span> Gostei
                                </a>
                                <a class="btn post-btnComentar col"> <span class=" fa-regular fa-comment"></span> Comentar</a>
                                <a class="btn post-btnCompartilhar col"><span class=" fa-solid fa-share"></span> Compartilhar</a>
                            </div>
                        </div>

                    </div>


                </div>
            }
        }
        else
        {
            <a>Não existem postagens :(</a>
        }

                          
              </div>

          </div>
                    
            
        
        
